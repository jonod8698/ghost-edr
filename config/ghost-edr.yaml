# Ghost EDR Configuration
# Used by the enforcer container via docker-compose.yml

# Logging level (debug, info, warning, error)
log_level: info

# Receiver configuration
receiver:
  type: http
  host: "0.0.0.0"
  port: 8766

# Shorthand for receiver port
receiver_port: 8766

# Container runtime (auto-detected if not specified)
# Options: docker_desktop, orbstack
runtime_auto_detect: true
# runtime_type: docker_desktop
# docker_socket: /var/run/docker.sock

# Default action for alerts that don't match any policy
default_action: alert

# Global webhook for all alerts (optional)
# global_webhook_url: "https://hooks.slack.com/services/XXX"

# Containers to exclude from monitoring
excluded_containers:
  - "ghost-mole"
  - "ghost-mole-*"

# Prometheus metrics endpoint
enable_metrics: true
metrics_port: 9090

# Policy rules (evaluated in order, first match wins)
policies:
  # Critical threats
  - name: critical-threats
    description: Alert on critical security threats
    priority_min: critical
    rule_patterns:
      - "Ghost EDR - Reverse Shell*"
      - "Ghost EDR - Crypto Miner*"
      - "Ghost EDR - Container Escape*"
      - "Ghost EDR - Nsenter*"
      - "Ghost EDR - Kernel Module*"
      - "Ghost EDR - Netcat Reverse Shell*"
      - "Ghost EDR - Download and Execute*"
      - "Ghost EDR - Process Injection*"
      - "Ghost EDR - Stratum Protocol*"
    action: alert
    cooldown_seconds: 0

  # High priority threats
  - name: high-threats
    description: Alert on high priority threats
    priority_min: error
    rule_patterns:
      - "Ghost EDR - Mining Pool Connection*"
      - "Ghost EDR - Mount in Privileged*"
      - "Ghost EDR - Shell Spawned from Web*"
      - "Ghost EDR - Docker Socket Access*"
      - "Ghost EDR - Sensitive File*"
    action: alert
    cooldown_seconds: 30

  # Suspicious activity
  - name: suspicious-activity
    description: Alert on suspicious activity
    priority_min: warning
    rule_patterns:
      - "Ghost EDR - Package Manager*"
      - "Ghost EDR - Hidden File*"
      - "Ghost EDR - Bash History*"
    action: alert
    cooldown_seconds: 60

  # Catch-all
  - name: default-alert
    description: Alert on any other matching events
    priority_min: warning
    action: alert
    cooldown_seconds: 120
